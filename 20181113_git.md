## git分支和代码版本规范建设

### 作者

ristorywang 

### 日期

2018-11-13


### git分支定义

#### 1.master

长期分支，一般用于管理对外发布版本，每个 commit 对一个 tag，也就是一个发布版本

分支名称：master

tag名称：tag_master/1.2.3.1_20180831



#### 2.develop

长期分支，开发主分支，用于验证代码合并正确性，该分支只做只合并操作，不能直接在该分支上开发

分支名称：develop



#### 3.feature

开发分支，短期分支，一般用于一个新功能的开发，开发完成后合并到对应develop分支

分支名称：feature/版本_功能_姓名 例：feature/1.2.3.1_shouxingaizao_pxk



#### 4.release

发布分支，短期分支，一般用于发布正式版本之前（即合并到 master 分支之前），需要有的预发布的版本进行测试。

提交测试前公开本次release分支，供develop进行合并操作

分支名称：release/1.2.3.1_功能_姓名

tag名称：tag_release/1.2.3.1_20180831



#### 5.hotfix

修复分支，短期分支 ，用于正式发布以后，出现 bug，需要创建一个分支，从master拉取，进行hot修复，修复完成后合并到master和develop。

分支名称：hotfix/1.2.3.1_功能_姓名_日期



#### 6.bugfix

修复分支，短期分支，开发从release分支拉出，bug修复后，由测试人员合并到release

分支名称：bugfix/1.2.3_姓名

![123](https://www.2cto.com/uploadfile/Collfiles/20170616/201706160923321366.png)


### 版本号规范和发布包规范

参考于语义化版本 2.0.0：https://semver.org/lang/zh-CN/


#### 服务版本号（5位） 如版本号为1.1.0.0.0

| 第N位 | 字段定义 | 备注 |
| --- | --- | --- |
| 1 | 重大主版 | 重大版本发布更新，初始值为1，每次变更+1；重大主版迭代后，下级字段初始化 |
| 2 | 较大版本 | 较大规模功能发布更新，初始值为0，每次变更+1；较大版本迭代后，下级字段初始化 |
| 3 | 日常版本 | 日常业务需求发布更新，初始值为0，每次变更+1；日常版本迭代后，下级字段恢复默认值 |
| 4 | 研发自增版本 | 研发驱动更新，初始值为0，每次变更+1；研发自增版本迭代后，此位恢复初始值 |
| 5 | 测试迭代标志 | 测试过程中的提交次数记录，初始值为0，每提测一次+1；研发自增版本迭代后，此位恢复初始值 |

  
版本号迭代示例：1.1.0.0.0-->1.1.0.0.1-->1.1.0.0.2–>1.1.0.1.0–>1.1.0.2.0-–>1.2.0.0.0–>1.3.0.0.0–>2.0.0.0.0–>2.1.0.0.0–>2.1.1.0.0

如果出现生产修复，迭代测试标志位

#### 组件版本号（4位）如版本号为1.1.0.0

| 第N位 | 字段定义 | 备注 |
| --- | --- | --- |
| 1 | 重大主版 | 重大版本发布更新，初始值为1，每次变更+1；重大主版迭代后，下级字段初始化 |
| 2 | 较大版本 | 较大规模功能发布更新，初始值为0，每次变更+1；较大版本迭代后，下级字段初始化 |
| 3 | 日常版本 | 日常业务需求发布更新，初始值为0，每次变更+1；日常版本迭代后，下级字段恢复默认值 |
| 4 | 研发自增版本 | 研发驱动更新，初始值为0，每次变更+1；研发自增版本迭代后，此位恢复初始值 |


版本号迭代示例：1.1.0.0-->1.1.0.1-->1.1.0.2–>1.1.1.0–>1.1.2.0-–>1.2.0.0–>1.3.0.0–>2.0.0.0–>2.1.0.0–>2.1.1.0

组件支持同版本号重复发布，通过服务版本号约束监控是否重新发布服务

#### 发布包(Jenkins/mvn等构建产出)
1.服务包命名：

发布包名称主要由服务名和版本号两部分组成：

服务名＋“-”＋版本号，zip格式

如by-funds-2.1.1.0.0.zip

解压开后同目录应得到对应同名文件夹